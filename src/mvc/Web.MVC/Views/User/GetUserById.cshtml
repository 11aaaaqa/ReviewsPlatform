@using System.Security.Claims
@model Web.MVC.Models.View_models.User.GetUserByIdViewModel

<img src="@Model.AvatarSrc"/>
<h3>@Model.User.UserName</h3>
<h4>Дата регистрации: @Model.User.RegistrationDate.ToString("dd.MM.yyyy")</h4>
@if (Model.CanUserViewTheRoles)
{
    @if (Model.User.Roles.Count > 0)
    {
        <h4>Роли:
            <span>@Model.User.Roles[0].Name</span>
            @for(int i = 1; i < Model.User.Roles.Count; i++)
            {
                <span>, @Model.User.Roles[i].Name</span>
            }
        </h4>
    }
    else
    {
        <h4>Ролей нет</h4>
    }

    @if (Model.CanUserSetTheRoles && Model.User.Id != new Guid(User.Claims.Single(x => x.Type == ClaimTypes.NameIdentifier).Value))
    {
        <button>Назначить роль</button>
        string returnUrl = Context.Request.Path;
        if (Context.Request.QueryString.HasValue)
            returnUrl += Context.Request.QueryString;
        <form method="post" asp-controller="User" asp-action="SetUserRoles" asp-route-userId="@Model.User.Id">
            <input type="hidden" name="returnUrl" value="@returnUrl"/>
            @foreach (var role in Model.AllRoles)
            {
                <p>
                    @if (Model.User.Roles.Any(x => x.Id == role.Id))
                    {
                        <input type="checkbox" name="roleIds" value="@role.Id" checked />
                    }
                    else
                    {
                        <input type="checkbox" name="roleIds" value="@role.Id" />
                    }
                    @role.Name
                </p>
            }
            
            <input type="submit" value="Сохранить"/>
        </form>
    }
}